# Keyword of the day

## Zadání

Ahoy, officer,

one of deck cadets (remember your early days onboard) had a simple task to prepare simple web application to announce keyword of the day. He claimed that the task is completed, but he forgot on which port the application is running. Unfortunately, he also prepared a lot of fake applications, he claims it was necessary for security reasons. Find the keyword of the day, so daily routines on ship can continue.

May you have fair winds and following seas!

The webs are running somewhere on server `keyword-of-the-day.cns-jv.tcc`.

Hint: Use VPN

## Řešení

### slepá ulička 1

- obfuskovaný kód
``` js
(function(_0x32e32d,_0x22286f){var _0x18b4e5=_0x4b01,_0x132488=_0x32e32d();while(!![]){try{var _0xe388e0=-parseInt(_0x18b4e5(0x200))/(0x7*-0x1a5+-0x196b+0x3d*0x9b)*(parseInt(_0x18b4e5(0x1f1))/(0x436+0x1f8f+-0x23c3))+parseInt(_0x18b4e5(0x1f7))/(0xf14+0x158f+-0x24a0)*(parseInt(_0x18b4e5(0x1fa))/(-0x1b51+0x1*-0xbd4+0x2729))+-parseInt(_0x18b4e5(0x211))/(-0x7e7+0x1dfe+-0x1612)*(-parseInt(_0x18b4e5(0x201))/(0x105*0x8+0xb21+-0x1*0x1343))+-parseInt(_0x18b4e5(0x1fb))/(-0x1602+-0xa39*0x1+-0x1*-0x2042)+parseInt(_0x18b4e5(0x1fc))/(0x218a+0x260d+0xa39*-0x7)+-parseInt(_0x18b4e5(0x1f8))/(0xa*0x15+0xd*0x17e+0x1*-0x142f)*(parseInt(_0x18b4e5(0x207))/(-0x2d9+0x1e29+-0x1b46))+-parseInt(_0x18b4e5(0x1f6))/(0x1f5*0xe+0x1d02+-0x385d)*(-parseInt(_0x18b4e5(0x1ff))/(0x56+-0x305*0x3+0x1*0x8c5));if(_0xe388e0===_0x22286f)break;else _0x132488['push'](_0x132488['shift']());}catch(_0x270ab6){_0x132488['push'](_0x132488['shift']());}}}(_0x4a7b,-0x458ad+-0xf005*-0x5+-0x2d818*-0x1));function getRandomInt(_0x12721b,_0x4bd30f){var _0x3d4eac=_0x4b01,_0x5961d6={'zkkfn':function(_0x270e45,_0x5f59e5){return _0x270e45+_0x5f59e5;},'Asxuo':function(_0x5d654a,_0x2376b3){return _0x5d654a*_0x2376b3;},'HtEjb':function(_0x51004d,_0x1f05d8){return _0x51004d-_0x1f05d8;}};return _0x12721b=Math[_0x3d4eac(0x213)](_0x12721b),_0x4bd30f=Math[_0x3d4eac(0x20b)](_0x4bd30f),Math[_0x3d4eac(0x20b)](_0x5961d6[_0x3d4eac(0x205)](_0x5961d6[_0x3d4eac(0x20e)](Math[_0x3d4eac(0x1f3)](),_0x5961d6[_0x3d4eac(0x20a)](_0x4bd30f,_0x12721b)),_0x12721b));}function _0x4a7b(){var _0x4a16f3=['THyXD','10MfNvVl','ById','lDpzQ','HtEjb','floor','loader','none','Asxuo','DjmmX','qPofo','30bFcpXC','display','ceil','EIqZp','style','.png','6udGmnh','myImage','random','src','Xgsvg','2147101xPxNCn','471JwkRMW','2613564LudmVH','kDzzS','7652NYkmqc','2626911gNaivg','3004968WoozMA','img/','Xscqw','12jxivPF','51806epgxkm','158706KaxUIc','3ca5a4049d','XpYtE','getElement','zkkfn'];_0x4a7b=function(){return _0x4a16f3;};return _0x4a7b();}function _0x4b01(_0xa29b0e,_0x68fa8b){var _0x1ae7c6=_0x4a7b();return _0x4b01=function(_0x42f0e7,_0x3bf93a){_0x42f0e7=_0x42f0e7-(0x125*-0x1+-0x191b*0x1+0x1c31);var _0x22e036=_0x1ae7c6[_0x42f0e7];return _0x22e036;},_0x4b01(_0xa29b0e,_0x68fa8b);}setTimeout(function(){var _0x23213c=_0x4b01,_0x2ee1d2={'qPofo':function(_0xb1f482,_0x32c5f6,_0x12d1bb){return _0xb1f482(_0x32c5f6,_0x12d1bb);},'kDzzS':_0x23213c(0x20c),'DjmmX':_0x23213c(0x20d),'lDpzQ':_0x23213c(0x202),'THyXD':_0x23213c(0x1f2),'Xgsvg':function(_0x5284ee,_0xb6da83){return _0x5284ee+_0xb6da83;},'EIqZp':function(_0x3cb2cd,_0x54e4c1){return _0x3cb2cd+_0x54e4c1;},'XpYtE':_0x23213c(0x1fd),'Xscqw':_0x23213c(0x216)};fn=_0x2ee1d2[_0x23213c(0x210)](getRandomInt,0x151f*0x1+0xc67*0x3+0x1b*-0x229,0x2361+0x2562+-0x48bf),document[_0x23213c(0x204)+_0x23213c(0x208)](_0x2ee1d2[_0x23213c(0x1f9)])[_0x23213c(0x215)][_0x23213c(0x212)]=_0x2ee1d2[_0x23213c(0x20f)],qn=_0x2ee1d2[_0x23213c(0x209)],document[_0x23213c(0x204)+_0x23213c(0x208)](_0x2ee1d2[_0x23213c(0x206)])[_0x23213c(0x1f4)]=_0x2ee1d2[_0x23213c(0x1f5)](_0x2ee1d2[_0x23213c(0x214)](_0x2ee1d2[_0x23213c(0x203)],fn),_0x2ee1d2[_0x23213c(0x1fe)]);},getRandomInt(-0x7fb+-0x1177*0x1+0x1*0x1973,0x10d*0x25+-0x1b8e+-0x4*0x2d3)*(-0x25ef+-0x2a5*-0x3+0x21e8));
```

- deobfuskace JS kódu na https://deobfuscate.io/ odhaduje, že to bylo jím obfuskované a vrátilo to následující kód

	``` js
	function getRandomInt(_0x12721b, _0x4bd30f) {
	  _0x12721b = Math.ceil(_0x12721b);
	  _0x4bd30f = Math.floor(_0x4bd30f);
	  return Math.floor(Math.random() * (_0x4bd30f - _0x12721b) + _0x12721b);
	}
	setTimeout(function () {
	  fn = getRandomInt(1, 4);
	  document.getElementById("loader").style.display = "none";
	  qn = "3ca5a4049d";
	  document.getElementById("myImage").src = "img/" + fn + ".png";
	}, getRandomInt(1, 7) * 1000);
	```

	- `Math.ceil()` always rounds up and returns the smallest integer greater than or equal to a given number
	- `Math.floor()` always rounds down and returns the largest integer less than or equal to a given number.
	- **k čemu je to "qn"???**

### slepá ulička 2

- jednotlivé stránky zobrazují pouze obrázky 1-3, ručně se dá dostat až k obrázku 7
	- gobusterem jsem prohledával URL/img/ ale nic jiného jsem nenašel
	- obrázky vypadají, jako by v nich byla posloupnost - čím vyšší číslo, tím více nadšený smajlík
		- 4.png = černé brýle
		- 5.png = rozzářené oči
		- 6.png = slavící smajlík
		- 7.png = tleskající smajlík

### řešení dle myšlenky cizího writeupu

Myšlenka: Výstup každého portu prohnat hash funkcí a podívat se, jestli jeden z portů není unikátní.

1. zjištění portů přes nmap: `nmap -v -T4 -Pn -p 1-65535 -sV -oN ports_service.txt 10.99.0.155`
2. úprava souboru, aby obsahoval jen seznam portů > soubor ports2.txt
3. md5sum výstupů nad každým portem, abych zjistil, jestli není některý jedinečný
	```
	# md5sum všech portů
	$ for PORT in `cat ports2.txt`; do echo -n ${PORT} ; echo -n " - "; curl -s keyword-of-the-day.cns-jv.tcc:${PORT} | md5sum >> sums.txt; done

	# úprava souboru se sums.txt, aby 

	# příprava seznamu unikátních
	$ cat sums2.txt | sort | uniq > sums-uniq.txt

	# počet jednotlivých md5sumů
	$ for SUM in `cat sums-uniq.txt`; do echo -n "$SUM - "; grep $SUM sums.txt | wc -l;
	 done
	 
	23037a782cc6de1106a1b702df5db558 - 15
	2a8bb80bc542012430f891554b6982fc - 14
	316fd5a5198805503ac2216791853c55 - 15
	365978f8649360dec14b4e7d4315823f - 15
	367bd3fd9943f4cd6904ad189e831546 - 15
	3b1a888ba7f713bc17eeb2b6629751ab - 15
	70922157a1c29318807f406a51afad01 - 10
	764f8ab16a5d5b8786afbd83c8bfa12e - 6
	8456c9b1eb642a82ca2a6fe554f28d6f - 13
	910e33150315b54bb9c77e3c6c9cb97a - 15
	9f944603d107dc12e58008872ee1796a - 14
	a6cfbfe0d90e367bfbd661330e770fc9 - 13
	abdacd812ee52d104449ac68e7571b77 - 14
	ba78fb78b670b1b1a4c15e525bc3000b - 1
	e7354658baa09bc89f4c417c223633e0 - 15
	f04cfce835f4fac1c86d3563364f6a68 - 15
	f15693c042a161cdb8a9d6fcf93ca21d - 14
	faebdb8ca1bcef5c3ea2ddd180df1d91 - 15

	# zjištění o jaký port se jedná 
	$ grep ba78fb78b670b1b1a4c15e525bc3000b sums.txt
	60257 - ba78fb78b670b1b1a4c15e525bc3000b
	```
4. jdu na ten unikátní port `http://keyword-of-the-day.cns-jv.tcc:60257/` 
5. dostanu hlášku: `For FLAG follow this URI /948cd06ca7`
6. na cílové stránce `http://keyword-of-the-day.cns-jv.tcc:60257/948cd06ca7` dostanu `Your flag is FLAG{DEIE-fiOr-pGV5-8MPc}`

FLAG = `FLAG{DEIE-fiOr-pGV5-8MPc}`